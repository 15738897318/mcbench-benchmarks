function [out] = cmbfast_read(param)

% =========================================================================
% cmbfast_read.m - A helper routine to load output files from CMBFAST
% Last modified: January 25, 2006
% Judd D. Bowman
%
% This function loads the output files generated by CMBFAST.  Pass to it
% the 'param' structure from cmbfast.m to load the files associated with
% a particular run of CMBFAST.
%
% >> results = cmbfast_read(param);
%
% INPUT
% =====
% param = the output structure from cmbfast(...) that contains the file names
% and parameters for a specific run of CMBFAST.
%
% OUTPUT
% ======
% results = a structure containing arrays data from the output files of
% CMBFAST.
%
% results.transfer = the transfer function data
% results.cl_unlensed = the (unlensed) CMB data
% results.cl_lensed = the (lensed) CMB data
% results.cl_tensor = the (tensor) CMB data
% results.cl_fits = information about a FITS file (if present)
% results.b_ftf = # of transfer function files found
% results.b_fcl = # of unlensed CMB files found
% results.b_fgl = # of lensed CMB files found
% results.b_tcl = # of tensor CMB files found
%
% =========================================================================

    % Read the CMBFAST output files into Matlab arrays 
    
    out.b_ftf = 0;
    out.b_fcl = 0;
    out.b_fgl = 0;
    out.b_tcl = 0;
    out.b_fts = 0;
    
    % Transfer function files
    if (iscell(param.ftf))
        
        out.transfer = cell(length(param.ftf), 1);
        
        for n=1:length(param.ftf)  
            if (exist(param.ftf{n}) > 0)
    	        out.transfer{n} = load(param.ftf{n}, '-ASCII');
                out.b_ftf = out.b_ftf + 1;
            end
        end
                
    else
        
        if (exist(param.ftf) > 0)
            out.transfer = load(param.ftf, '-ASCII');
            out.b_ftf = 1;
        end
        
    end
    
    % C_l (unlensed) file
    if (exist(param.fcl) > 0)
        out.cl_unlensed = load(param.fcl, '-ASCII');
        out.b_fcl = 1;
    end
    
    % C_l (lensed) file
    if (exist(param.fgl) > 0)
        out.cl_lensed = load(param.fgl, '-ASCII');
        out.b_fgl = 1;
    end

    % C_l (tensor) file
    if (exist(param.tcl) > 0)
        out.cl_tensor = load(param.tcl, '-ASCII');
        out.b_tcl = 1;
    end
    
    % FITS output
    if (exist(param.fts) > 0)
        out.fitsinfo = fitsinfo(param.fts);
        out.b_fts = 1;
    end
    